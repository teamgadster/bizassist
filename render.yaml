# BizAssist_api
services:
  - type: web
    name: bizassist-api
    runtime: node
    plan: starter
    region: oregon
    rootDir: api
    buildCommand: npm ci --include=dev && npm run build
    preDeployCommand: npm run prisma:deploy
    startCommand: npm start
    autoDeployTrigger: commit
    healthCheckPath: /api/v1/health
    maxShutdownDelaySeconds: 120
    envVars:
      - fromGroup: bizassist-api-defaults
      - key: DATABASE_URL
        fromDatabase:
          name: bizassist-postgres
          property: connectionString
      - key: DIRECT_URL
        sync: false
      - key: ACCESS_TOKEN_SECRET
        sync: false
      - key: REFRESH_TOKEN_SECRET
        sync: false
      - key: CORS_ORIGIN
        sync: false
      - key: OTP_HASH_SECRET
        sync: false
      - key: SUPABASE_URL
        sync: false
      - key: SUPABASE_SERVICE_ROLE_KEY
        sync: false
      - key: SUPABASE_STORAGE_DEFAULT_BUCKET
        sync: false
      - key: SUPABASE_STORAGE_PRODUCT_BUCKET
        sync: false
      - key: SUPABASE_STORAGE_USER_BUCKET
        sync: false
      - key: SUPABASE_STORAGE_BUSINESS_BUCKET
        sync: false
      - key: AWS_REGION
        value: ap-southeast-1
      - key: AWS_ACCESS_KEY_ID
        sync: false
      - key: AWS_SECRET_ACCESS_KEY
        sync: false
      - key: SES_FROM_EMAIL
        sync: false
      - key: EMAIL_REPLY_TO
        sync: false
      - key: SES_CONFIGURATION_SET
        sync: false

databases:
  - name: bizassist-postgres
    plan: basic-256mb
    region: oregon
    databaseName: bizassist
    user: bizassist
    postgresMajorVersion: "18"
    ipAllowList: []

envVarGroups:
  - name: bizassist-api-defaults
    envVars:
      - key: NODE_VERSION
        value: 20.20.0
      - key: NODE_ENV
        value: production
      - key: NPM_CONFIG_PRODUCTION
        value: "false"
      - key: YARN_PRODUCTION
        value: "false"
      - key: ACCESS_TOKEN_EXPIRES_IN
        value: 15m
      - key: REFRESH_TOKEN_EXPIRES_IN_DAYS
        value: "7"
      - key: BCRYPT_ROUNDS
        value: "10"
      - key: OTP_ENABLED
        value: "false"
      - key: SUPABASE_ENABLED
        value: "false"

# Template: Background worker (disabled until uncommented)
# services:
#   - type: worker
#     name: bizassist-worker
#     runtime: node
#     plan: starter
#     region: oregon
#     rootDir: api
#     buildCommand: npm ci --include=dev && npm run build
#     startCommand: node dist/worker.js
#     autoDeployTrigger: commit
#     maxShutdownDelaySeconds: 120
#     envVars:
#       - fromGroup: bizassist-api-defaults
#       - key: DATABASE_URL
#         fromDatabase:
#           name: bizassist-postgres
#           property: connectionString
#       - key: DIRECT_URL
#         sync: false
#       - key: ACCESS_TOKEN_SECRET
#         sync: false
#       - key: REFRESH_TOKEN_SECRET
#         sync: false
#       - key: CORS_ORIGIN
#         sync: false
#       - key: OTP_HASH_SECRET
#         sync: false
#       - key: SUPABASE_URL
#         sync: false
#       - key: SUPABASE_SERVICE_ROLE_KEY
#         sync: false
#       - key: SUPABASE_STORAGE_DEFAULT_BUCKET
#         sync: false
#       - key: SUPABASE_STORAGE_PRODUCT_BUCKET
#         sync: false
#       - key: SUPABASE_STORAGE_USER_BUCKET
#         sync: false
#       - key: SUPABASE_STORAGE_BUSINESS_BUCKET
#         sync: false
#       - key: AWS_REGION
#         value: ap-southeast-1
#       - key: AWS_ACCESS_KEY_ID
#         sync: false
#       - key: AWS_SECRET_ACCESS_KEY
#         sync: false
#       - key: SES_FROM_EMAIL
#         sync: false
#       - key: EMAIL_REPLY_TO
#         sync: false
#       - key: SES_CONFIGURATION_SET
#         sync: false
